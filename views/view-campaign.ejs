<% include ./partials/managerNav %>

<head>
    <title>Super Campaign</title>
    <style>
        /* Set the size of the div element that contains the map */
        #map {
            height: 400px;
            /* The height is 400 pixels */
            width: 100%;
            /* The width is the width of the web page */
            background-color: grey;
        }
    </style>

    <link rel="stylesheet" type="text/css" href="/stylesheets/view-campaign.css">
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.1.1/socket.io.js"></script>
</head>

<body>
    <div class="container">
        <% if (id === ""){ %>
        <h2>Campaign was not found.</h2>
        <% } else { %>
        <div class="accordion-option">
            <h1 class="title">View Campaign</h1>
            <!-- <a href="javascript:void(0)" style="text-decoration:none" class="toggle-accordion" accordion-id="#accordion"></a> -->
            <a href="javascript:void(0)" class="openAll" style="text-decoration:none">&nbspExpand All</a>
            <a href="javascript:void(0)" class="closeAll" style="text-decoration:none">Collapse All&nbsp</a>

        </div><!-- div.accordion-option -->
        <div class="clearfix"></div>

        <div class="accordion panel-group" id="accordion" aria-multiselectable="true">
            <!--Campaign ID-->
            <div class="card panel panel-default">
                <div class="card-header panel-heading">
                    <h4 class="panel-title">
                        <a class="panel-title-text" data-toggle="collapse" data-parent="#accordion" href="#collapseCamID"
                            style="text-decoration:none" aria-expanded="true" aria-controls="collapseOne">
                            Campaign ID
                        </a>
                    </h4>
                </div>
                <!--div.panel-heading-->
                <div id="collapseCamID" class="panel-collapse show">
                    <div class="card-body panel-body">
                        <%= id %>
                    </div>
                </div>
                <!--div.panel-collaspe-->
            </div>
            <!--div.panel-->

            <!--Campaign Name-->
            <div class="card panel panel-default">
                <div class="card-header panel-heading">
                    <h4 class="panel-title">
                        <a class="panel-title-text" data-toggle="collapse" data-parent="#accordion" href="#collapseCamName"
                            style="text-decoration:none" aria-expanded="true" aria-controls="collapseOne">
                            Campaign Name
                        </a>
                    </h4>
                </div>
                <!--div.panel-heading-->
                <div id="collapseCamName" class="panel-collapse show">
                    <div class="card-body panel-body">
                        <%= name %>
                    </div>
                </div>
                <!--div.panel-collaspe-->
            </div>
            <!--div.card div.panel-->

            <!--Start Date-->
            <div class="card panel panel-default">
                <div class="card-header panel-heading">
                    <h4 class="panel-title">
                        <a class="panel-title-text" data-toggle="collapse" data-parent="#accordion" href="#collapseStartDate"
                            style="text-decoration:none" aria-expanded="true" aria-controls="collapseOne">
                            Start Date
                        </a>
                    </h4>
                </div>
                <!--div.panel-heading-->
                <div id="collapseStartDate" class="panel-collapse show">
                    <div class="card-body panel-body">
                        <%= sDate %>
                    </div>
                </div>
                <!--div.panel-collaspe-->
            </div>
            <!--div.card div.panel-->

            <!--End Date-->
            <div class="card panel panel-default">
                <div class="card-header panel-heading">
                    <h4 class="panel-title">
                        <a class="panel-title-text" data-toggle="collapse" data-parent="#accordion" href="#collapseEndDate"
                            style="text-decoration:none" aria-expanded="true" aria-controls="collapseOne">
                            End Date
                        </a>
                    </h4>
                </div>
                <!--div.panel-heading-->
                <div id="collapseEndDate" class="panel-collapse show">
                    <div class="card-body panel-body">
                        <%= endDate %>
                    </div>
                </div>
                <!--div.panel-collaspe-->
            </div>
            <!--div.card div.panel-->

            <!--Estimated Visit Duration-->
            <div class="card panel panel-default">
                <div class="card-header panel-heading">
                    <h4 class="panel-title">
                        <a class="panel-title-text" data-toggle="collapse" data-parent="#accordion" href="#collapseDuration"
                            style="text-decoration:none" aria-expanded="true" aria-controls="collapseOne">
                            Estimated Visit Duration
                        </a>
                    </h4>
                </div>
                <!--div.panel-heading-->
                <div id="collapseDuration" class="panel-collapse show">
                    <div class="card-body panel-body">
                        <%= duration %> minutes
                    </div>
                </div>
                <!--div.panel-collaspe-->
            </div>
            <!--div.card div.panel-->

            <!--Campaign's Managers-->
            <div class="card panel panel-default">
                <div class="card-header panel-heading">
                    <h4 class="panel-title">
                        <a class="panel-title-text" data-toggle="collapse" data-parent="#accordion" href="#collapseCamManagers"
                            style="text-decoration:none" aria-expanded="true" aria-controls="collapseOne">
                            Campaign Managers
                        </a>
                    </h4>
                </div>
                <!--div.panel-heading-->
                <div id="collapseCamManagers" class="panel-collapse show">
                    <div class="card-body panel-body">
                        <!--Start of table-->
                        <div class="table-responsive">
                            <table class="table table-hover table-striped">
                                <thead class="thead-light">
                                    <th class="">ID</th>
                                    <th class="">Manager Name</th>
                                </thead>
                                <tbody>
                                    <% for (var i = 0; i < manager.length; i++){ %>
                                    <tr>
                                        <td>
                                            <%= manager[i].ID.employeeID %>
                                        </td>
                                        <td>
                                            <%= manager[i].ID.name %>
                                        </td>
                                    </tr>
                                    <% } %>
                                </tbody>
                            </table>
                        </div>
                        <!--div.table-responsive-->
                        <!--End of Table-->
                    </div>
                </div>
                <!--div.panel-collaspe-->
            </div>
            <!--div.card div.panel-->

            <!--Campaign's Canvassers-->
            <div class="card panel panel-default">
                <div class="card-header panel-heading">
                    <h4 class="panel-title">
                        <a class="panel-title-text" data-toggle="collapse" data-parent="#accordion" href="#collapseCamCanvassers"
                            style="text-decoration:none" aria-expanded="true" aria-controls="collapseOne">
                            Campaign Canvassers
                        </a>
                    </h4>
                </div>
                <!--div.panel-heading-->
                <div id="collapseCamCanvassers" class="panel-collapse show">
                    <div class="card-body panel-body">
                        <!--Start of table-->
                        <div class="table-responsive">
                            <table class="table table-hover table-striped">
                                <thead class="thead-light">
                                    <th class="">ID</th>
                                    <th class="">Canvasser Name</th>
                                </thead>
                                <tbody>
                                    <% for (var i = 0; i < canv.length; i++){ %>
                                    <tr>
                                        <td>
                                            <%= canv[i].ID.employeeID %>
                                        </td>
                                        <td>
                                            <%= canv[i].ID.name %>
                                        </td>
                                    </tr>
                                    <% } %>
                                </tbody>
                            </table>
                        </div>
                        <!--div.table-responsive-->
                        <!--End of Table-->
                    </div>
                </div>
                <!--div.panel-collaspe-->
            </div>
            <!--div.card div.panel-->

            <!--Questionaire-->
            <div class="card panel panel-default">
                <div class="card-header panel-heading">
                    <h4 class="panel-title">
                        <a class="panel-title-text" data-toggle="collapse" data-parent="#accordion" href="#collapseCamQuestionnaire"
                            style="text-decoration:none" aria-expanded="true" aria-controls="collapseOne">
                            Questionnaire
                        </a>
                    </h4>
                </div>
                <!--div.panel-heading-->
                <div id="collapseCamQuestionnaire" class="panel-collapse show">
                    <div class="card-body panel-body">
                        <!--Start of table-->
                        <div class="table-responsive">
                            <table class="table table-hover table-striped">
                                <thead class="thead-light">
                                    <th class="">Questions</th>
                                </thead>
                                <tbody>
                                    <% for(var i=0; i < question.length; i++){ %>
                                    <tr>
                                        <td>
                                            <%= question[i].question %>
                                        </td>
                                    </tr>
                                    <% } %>
                                </tbody>
                            </table>
                        </div>
                        <!--div.table-responsive-->
                        <!--End of Table-->
                    </div>
                </div>
                <!--div.panel-collaspe-->
            </div>
            <!--div.card div.panel-->

            <!--Talking Points-->
            <div class="card panel panel-default">
                <div class="card-header panel-heading">
                    <h4 class="panel-title">
                        <a class="panel-title-text" data-toggle="collapse" data-parent="#accordion" href="#collapseCamTalkPoints"
                            style="text-decoration:none" aria-expanded="true" aria-controls="collapseOne">
                            Talking Points
                        </a>
                    </h4>
                </div>
                <!--div.panel-heading-->
                <div id="collapseCamTalkPoints" class="panel-collapse show">
                    <div class="card-body panel-body">
                        <!--Start of table-->
                        <div class="table-responsive">
                            <table class="table table-hover table-striped">
                                <thead class="thead-light">
                                    <th class="">Talking Points</th>
                                </thead>
                                <tbody>
                                    <% for(var i=0; i < points.length; i++){ %>
                                    <tr>
                                        <td>
                                            <%= points[i].talk %>
                                        </td>
                                    </tr>
                                    <% } %>
                                </tbody>
                            </table>
                        </div>
                        <!--div.table-responsive-->
                        <!--End of Table-->
                    </div>
                </div>
                <!--div.panel-collaspe-->
            </div>
            <!--div.card div.panel-->

            <!--Locations-->
            <div class="card panel panel-default">
                <div class="card-header panel-heading">
                    <h4 class="panel-title">
                        <a class="panel-title-text" data-toggle="collapse" data-parent="#accordion" href="#collapseCamLocations"
                            style="text-decoration:none" aria-expanded="true" aria-controls="collapseOne">
                            Locations Table View
                        </a>
                    </h4>
                </div>
                <!--div.panel-heading-->
                <div id="collapseCamLocations" class="panel-collapse show">
                    <div class="card-body panel-body">
                        <!--Start of table-->
                        <div class="table-responsive">
                            <table class="table table-hover table-striped">
                                <thead class="thead-light">
                                    <th class="">Door Number</th>
                                    <th class="">Street</th>
                                    <th class="">Unit</th>
                                    <th class="">City</th>
                                    <th class="">State</th>
                                    <th class="">ZIP Code</th>
                                </thead>
                                <tbody>
                                    <% for(var i=0; i < locationz.length; i++){ %>
                                    <tr>
                                        <td>
                                            <%= locationz[i]._streetNumber %>
                                        </td>
                                        <td>
                                            <%= locationz[i]._street %>
                                        </td>
                                        <td>
                                            <%= locationz[i]._unit %>
                                        </td>
                                        <td>
                                            <%= locationz[i]._city %>
                                        </td>
                                        <td>
                                            <%= locationz[i]._state %>
                                        </td>
                                        <td>
                                            <%= locationz[i]._zipcode %>
                                        </td>
                                    </tr>
                                    <% } %>
                                </tbody>
                            </table>
                        </div>
                        <!--div.table-responsive-->
                        <!--End of Table-->
                    </div>
                </div>
                <!--div.panel-collaspe-->
            </div>
            <!--div.card div.panel-->

            <!--Map-->
            <div class="card panel panel-default">
                <div class="card-header panel-heading">
                    <h4 class="panel-title">
                        <a class="panel-title-text" data-toggle="collapse" data-parent="#accordion" href="#collapseMap"
                            style="text-decoration:none" aria-expanded="true" aria-controls="collapseOne">
                            Locations Map View
                        </a>
                    </h4>
                </div>
                <!--div.panel-heading-->
                <div id="collapseMap" class="panel-collapse show">
                    <div class="card-body panel-body">
                        <!--Map part of the page-->
                        <div id="map"></div>
                    </div>
                </div>
                <!--div.panel-collaspe-->
            </div>
            <!--div.card div.panel-->

        </div>
        <!--div.accordion div.panel-group-->
        <% } %>
        <!--If else loof for wheter a campaign was found on server-->

        <script>
            var map;
            var usa = { lat: 37.09024, lng: -95.7129 };
            var markers = [];

            function initMap() {
                map = new google.maps.Map(document.getElementById('map'), {
                    center: usa,
                    zoom: 2
                });
            }


            var markers = [];
            var getMarkerUniqueId = function (lat, lng) {
                return lat + '_' + lng;
            }
            //Adds marker to map and push to the array
            function addMarker(location) {
                var markerId = getMarkerUniqueId(location.lat, location.lng);
                var marker = new google.maps.Marker({
                    position: location,
                    map: map,
                    animation: google.maps.Animation.DROP,
                    id: markerId
                });
                markers[markerId] = marker;
            }

            //** sets the map on all markers in the array
            function setMapOnAll(map) {
                for (marker in markers) {
                    markers[marker].setMap(map);
                }
            }

            // Removes the markers from the map, but keeps them in the array.
            function clearMarkers() {
                setMapOnAll(null);
            }
            // Deletes all markers in the array by removing references to them.
            function deleteMarkers() {
                clearMarkers();
                markers = [];
            }

            var removeMarker = function (marker, markerId) {
                marker.setMap(null); // set markers setMap to null to remove it from map
                delete markers[markerId]; // delete marker instance from markers object
            };

            var socket = io();
            $(document).ready(function () {
                socket.on('geocodes', function (geocodes) {
                    deleteMarkers();
                    console.log("EMPTY" + markers);
                    console.log("ALL:" + geocodes);
                    for (i in geocodes) {
                        parsedGeocode = { lat: parseFloat(geocodes[i].lat), lng: parseFloat(geocodes[i].lng) };
                        console.log("EACH" + parsedGeocode);
                        addMarker(parsedGeocode);
                    }
                    map.setZoom(5);
                    map.setCenter(new google.maps.LatLng(parseFloat(geocodes[0].lat), parseFloat(geocodes[0].lng)));

                });
            });

        </script>
        <script async defer src="https://maps.googleapis.com/maps/api/js?key=GOOGLE API KEY&callback=initMap"></script>
        <script src="/scripts/view-campaign.js"></script>

    </div><!-- div.container -->


    <% include ./partials/footer %>